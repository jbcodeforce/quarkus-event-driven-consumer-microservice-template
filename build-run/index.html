



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.0.1">
    
    
      
        <title>Build & Run - Quarkus based event driven microservice using Kafka</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.982221ab.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.1f0bcf2b.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../extra.css">
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#build-and-run-locally" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Quarkus based event driven microservice using Kafka" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Quarkus based event driven microservice using Kafka
            </span>
            <span class="md-header-nav__topic">
              Build & Run
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/jbcodeforce/quarkus-event-driven-consumer-microservice-template/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Quarkus based event driven microservice using Kafka" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Quarkus based event driven microservice using Kafka
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/jbcodeforce/quarkus-event-driven-consumer-microservice-template/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Build & Run
      </label>
    
    <a href="./" title="Build & Run" class="md-nav__link md-nav__link--active">
      Build & Run
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#environment-variables-used" title="Environment variables used" class="md-nav__link">
    Environment variables used
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-the-application-in-dev-mode" title="Running the application in dev mode" class="md-nav__link">
    Running the application in dev mode
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#packaging-and-running-the-application" title="Packaging and running the application" class="md-nav__link">
    Packaging and running the application
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-and-run-a-native-executable" title="Creating and run a native executable" class="md-nav__link">
    Creating and run a native executable
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment-to-openshift-while-developing" title="Deployment to openshift while developing" class="md-nav__link">
    Deployment to openshift while developing
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#define-the-configuration-map" title="Define the configuration map" class="md-nav__link">
    Define the configuration map
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-project" title="Create project" class="md-nav__link">
    Create project
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-from-native-image" title="Build from native image" class="md-nav__link">
    Build from native image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-from-source" title="Build from source" class="md-nav__link">
    Build from source
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#config-the-app-and-routes" title="Config the app and routes" class="md-nav__link">
    Config the app and routes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#next-pure-java-build" title="Next pure java build" class="md-nav__link">
    Next pure java build
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../devops/" title="DevOps" class="md-nav__link">
      DevOps
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../tests/" title="Tests" class="md-nav__link">
      Tests
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../quarkus-summary/" title="Quarkus summary" class="md-nav__link">
      Quarkus summary
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../compendium/" title="Compendium" class="md-nav__link">
      Compendium
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#environment-variables-used" title="Environment variables used" class="md-nav__link">
    Environment variables used
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-the-application-in-dev-mode" title="Running the application in dev mode" class="md-nav__link">
    Running the application in dev mode
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#packaging-and-running-the-application" title="Packaging and running the application" class="md-nav__link">
    Packaging and running the application
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-and-run-a-native-executable" title="Creating and run a native executable" class="md-nav__link">
    Creating and run a native executable
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment-to-openshift-while-developing" title="Deployment to openshift while developing" class="md-nav__link">
    Deployment to openshift while developing
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#define-the-configuration-map" title="Define the configuration map" class="md-nav__link">
    Define the configuration map
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-project" title="Create project" class="md-nav__link">
    Create project
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-from-native-image" title="Build from native image" class="md-nav__link">
    Build from native image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-from-source" title="Build from source" class="md-nav__link">
    Build from source
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#config-the-app-and-routes" title="Config the app and routes" class="md-nav__link">
    Config the app and routes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#next-pure-java-build" title="Next pure java build" class="md-nav__link">
    Next pure java build
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/jbcodeforce/quarkus-event-driven-consumer-microservice-template/edit/master/docs/build-run.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="build-and-run-locally">Build and run locally</h1>
<p>you can build a Quarkus application either as a standard Java application (using the docker build file: <code>src/main/docker/Dockerfile.jvm</code>)or as a native executable using GraalVM (and -Dnative) and the (<code>src/main/docker/Dockerfile.native</code>).</p>
<h2 id="environment-variables-used">Environment variables used</h2>
<ul>
<li>KAFKA_BROKERS</li>
<li>KAFKA_APIKEY
If the topic name is different that the one in the application.properties</li>
<li>KAFKA_MAIN_TOPIC</li>
</ul>
<p>When connected to a Kafka cluster using TLS certificate add:</p>
<ul>
<li>TRUSTSTORE_ENABLED</li>
<li>TRUSTSTORE_PATH</li>
<li>TRUSTSTORE_PWD</li>
</ul>
<h2 id="running-the-application-in-dev-mode">Running the application in dev mode</h2>
<p>You can run your application in dev mode that enables live coding using:</p>
<div class="codehilite"><pre><span></span>./mvnw quarkus:dev
</pre></div>

<p>When launching a Quarkus app simply using mvn quarkus:dev, the running application is configured to open port 5005 for remote debugging. That means that all you have to do is point your remote debugger to that port and you will be able to debug it in your favorite IDE/lightweight editor.</p>
<ul>
<li>Verify the memory usage: <code>ps -o pid,rss,command -p $(grep -f runner)</code></li>
</ul>
<h2 id="packaging-and-running-the-application">Packaging and running the application</h2>
<p>The application is packageable using <code>./mvnw package</code>.
It produces the executable <code>quarkus-kafka-consumer-1.0.0-SNAPSHOT-runner.jar</code> file in <code>/target</code> directory.
Be aware that it’s not an <em>über-jar</em> as the dependencies are copied into the <code>target/lib</code> directory.</p>
<p>The application is now runnable using <code>java -jar target/quarkus-kafka-consumer-1.0.0-SNAPSHOT-runner.jar</code>.</p>
<h2 id="creating-and-run-a-native-executable">Creating and run a native executable</h2>
<p>Start the GraalVM docker image to work in a contained development environment: </p>
<div class="codehilite"><pre><span></span>docker run -ti -v <span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>:/home -p <span class="m">8080</span>:8080 oracle/graalvm-ce:latest 
</pre></div>

<p>You can create a native (to your local OS) executable using: <code>./mvnw package -Pnative</code>.</p>
<p>Or you can use Docker to build the linux native executable using: </p>
<div class="codehilite"><pre><span></span>./mvnw package -Pnative -Dquarkus.native.container-build<span class="o">=</span><span class="nb">true</span>
</pre></div>

<p>You can then execute your binary: </p>
<div class="codehilite"><pre><span></span>./target/quarkus-kafka-consumer-1.0.0-SNAPSHOT-runner
</pre></div>

<h2 id="deployment-to-openshift-while-developing">Deployment to openshift while developing</h2>
<h3 id="define-the-configuration-map">Define the configuration map</h3>
<h3 id="create-project">Create project</h3>
<div class="codehilite"><pre><span></span>oc new-project eda-sandbox --display-name<span class="o">=</span><span class="s2">&quot;EDA kafka play with quarkus&quot;</span>
</pre></div>

<h3 id="build-from-native-image">Build from native image</h3>
<p>Define a build configuration 
<div class="codehilite"><pre><span></span>oc new-build quay.io/redhat/ubi-quarkus-native-runner --binary --name<span class="o">=</span>eda-orders-consumer-native -l <span class="nv">app</span><span class="o">=</span>eda-orders-consumer

oc start-build eda-orders-consumer-native --from-file<span class="o">=</span>target/quarkus-kafka-consumer-1.0.0-SNAPSHOT-runner --follow
</pre></div></p>
<p>!!! Note:
        The native image does not work as some of the SaslClient classes from Kafka API does not have a public no-argument constructor</p>
<h3 id="build-from-source">Build from source</h3>
<p>Define a pure java build process
<div class="codehilite"><pre><span></span>oc new-build registry.access.redhat.com/redhat-openjdk-18/openjdk18-openshift --binary --name=eda-orders-consumer -l app=eda-orders-consumer

./mvnw clean
oc start-build eda-orders-consumer --from-file=. --follow
</pre></div></p>
<h3 id="config-the-app-and-routes">Config the app and routes</h3>
<div class="codehilite"><pre><span></span><span class="c1"># the name of the application needs to match the app tag specified with the new build.</span>
oc new-app eda-orders-consumer
<span class="c1"># get the deployment configuration</span>
oc get dc
<span class="c1"># Add environment variables:</span>
c <span class="nb">set</span> env dc/eda-orders-consumer <span class="nv">KAFKA_BROKERS</span><span class="o">=</span>broker-3-qnprtqnp7hnkssdz.kafka.svc01.us-east.eventstreams.cloud.ibm.com:9093,broker-1-qnprtqnp7hnkssdz.kafka.svc01.us-east.eventstreams.cloud.ibm.com:9093,broker-0-qnprtqnp7hnkssdz.kafka.svc01.us-east.eventstreams.cloud.ibm.com:9093,broker-5-qnprtqnp7hnkssdz.kafka.svc01.us-east.eventstreams.cloud.ibm.com:9093,broker-2-qnprtqnp7hnkssdz.kafka.svc01.us-east.eventstreams.cloud.ibm.com:9093,broker-4-qnprtqnp7hnkssdz.kafka.svc01.us-east.eventstreams.cloud.ibm.com:9093
<span class="c1"># Add secret for the api key and reference it for environment variables</span>

<span class="c1"># expose the service as route to be accessible to external apps</span>
oc expose service eda-orders-consumer
<span class="c1"># get apps URL</span>
oc get routes
<span class="c1"># verify the access</span>
curl eda-orders-consumer-jb-sandbox.gse-eda-demos-...-0001.us-east.containers.appdomain.cloud/hello
</pre></div>

<h3 id="next-pure-java-build">Next pure java build</h3>
<div class="codehilite"><pre><span></span>oc start-build eda-orders-consumer --from-file<span class="o">=</span>. --follow
</pre></div>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href=".." title="Introduction" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Introduction
              </span>
            </div>
          </a>
        
        
          <a href="../devops/" title="DevOps" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                DevOps
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.b806dc00.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>